/*
 * MPlayer ver. 1.0.2
 * jQuery Sound Manager 2 Plugin
 *
 * Copyright (c) 2013 Mariusz Rek
 * Rascals Labs 2013
 *
 */

(function(g){var f=null,a=null,d=null,c=true,e=null;$global_volume=true;$track_vol=null;var b={init:function(h){f=this;h.volume==undefined?h.volume=100:h.volume=h.volume;
h.global_volume==undefined?h.global_volume=true:h.global_volume=h.global_volume;a=h;g.ajax({url:h.sm,dataType:"script",success:function(){$smObj={onready:function(){soundManager._writeDebug("SM2 ready!");
d=true;f.MPlayer("update");h.onReady.call(this);return;},ontimeout:function(){soundManager._writeDebug("SM2 init failed!");},defaultOptions:{volume:h.volume,usePeakData:false}};
g.extend(h.smOptions,$smObj);soundManager.setup(h.smOptions);}});},update:function(){soundManager._writeDebug("MPlayer ready!");var h="ontouchstart" in window,l=h?"touchstart":"mousedown",m=h?"touchmove":"mousemove",i=h?"touchend":"mouseup",j=h?"touchcancel":"mouseup";
var k=".mp-playlist";if(a.playlistSelector!=undefined&&a.playlistSelector!=""){k=a.playlistSelector;}if(g(k).length>0){g(k).each(function(n){var q=g(this),p=q.data("autoplay"),o=q.data("playnext");
$length=q.find(f).length-1;o==undefined||o==false?o=false:o=true;p==undefined||p==false?p=false:p=true;q.find(f).each(function(r){if(p&&r==0){g(this).data("autoplay",true);
}if(o&&r<$length){g(this).data("playnext",true);}});});}f.each(function(n){var u=g(this),q,t=null,p,s="mp"+n,o=u.data("autoplay"),q=u.data("title"),p=u.data("url"),r=u.data("volume");
if(u.hasClass("ready")){return;}o==undefined||o==false?o=false:o=true;q!=undefined&&q!=""?q=q:q=u.text();p!=undefined&&p!=""?p=p:p=u.attr("href");r!=undefined&&r!=""?r=r:r=a.volume;
if(!soundManager.canPlayURL(p)){soundManager._writeDebug(p+" - this track can not be played!");}u.attr("id",s);$ui_markup='   				<span class="track-title">'+q+' 	  				<span class="ui timing"> 	  					<span class="elapsed"></span><span class="total"></span> 	  				</span>   				</span>   				<span class="ui volume">   					<span class="vol-position"></span>   				</span>   				<span class="ui progress">   					<span class="loading"></span><span class="position"></span>   				</span>';
if(a.uiMarkup!=undefined&&a.uiMarkup!=""){$ui_markup=a.uiMarkup;}u.text("");u.append($ui_markup);u.find(".vol-position").css("width",r+"%");$sound=u.data("mplayer");
u.data("mplayer",soundManager.createSound({id:s,url:p,volume:r,onload:function(){soundManager._writeDebug("----------- onLoad - "+this.id);u.triggerHandler("mponloaded.mplayer");
u.addClass("loaded").removeClass("loading");},onplay:function(){soundManager._writeDebug("----------- onplay - "+this.id);u.triggerHandler("mponplay.mplayer");
u.removeClass("paused").addClass("playing");if(u.data("mplayer").readyState==1){u.addClass("loading");}if($global_volume&&$track_vol){u.find(".vol-position").css("width",$track_vol+"%");
u.data("mplayer").setVolume($track_vol);}},onpause:function(){soundManager._writeDebug("---------- onpause - "+this.id);u.triggerHandler("mponpause.mplayer");
if(!t){u.removeClass("playing").addClass("paused");}},onresume:function(){soundManager._writeDebug("--------- onresume - "+this.id);u.triggerHandler("mponresume.mplayer");
u.removeClass("paused").addClass("playing");},onstop:function(){soundManager._writeDebug("----------- onstop - "+this.id);u.triggerHandler("mponstop.mplayer");
u.removeClass("playing loading paused");u.find(".elapsed, .total").empty();u.find(".position").width(0);},onfinish:function(){soundManager._writeDebug("-------- onfinish - "+this.id);
u.triggerHandler("mponfinish.mplayer");u.removeClass("playing loading paused");u.find(".elapsed, .total").empty();u.find(".position").width(0);if(u.data("playnext")!=undefined&&u.data("playnext")==true){soundManager._writeDebug("---------------------------> next");
var w=n+1,v=g("#mp"+w);if(v.length>0){v.data("mplayer").play();e=v.data("mplayer");}}},whileloading:function(){u.find(".loading").width(u.data("mplayer").bytesLoaded/u.data("mplayer").bytesTotal*100+"%");
},whileplaying:function(){u.find(".position").width(u.data("mplayer").position/u.data("mplayer").durationEstimate*100+"%");u.find(".elapsed").html("("+_formatTime(u.data("mplayer").position));
u.find(".total").html("/"+_formatTime(u.data("mplayer").durationEstimate)+")");}})).addClass("ready").click(function(v){$this=g(this).data("mplayer");if(e&&e!=$this){e.stop();
e.setPosition(0);}if(!$this.paused){e=$this;}$this.togglePause();v.preventDefault();}).bind("mponloaded.mplayer",function(){u.triggerHandler("onloaded");
}).bind("mponplay.mplayer mponresume.mplayer",function(){u.triggerHandler("onplay");}).bind("mponpause.mplayer",function(){u.triggerHandler("onpause");
}).bind("mponstop.mplayer",function(){u.triggerHandler("onstop");}).bind("mponfinish.mplayer",function(){u.triggerHandler("onfinish");}).find(".ui").bind("click",function(){return false;
}).filter(".progress").bind(l,function(z){var v=g(this).addClass("searching"),A=v.find(".postion"),x=v.offset().left,w=v.width(),y=v.parent().data("mplayer");
t=true;y.pause();g(document).bind(m,function(D){var B=h?D.originalEvent.touches[0]:D;var C=Math.max(0,Math.min(B.clientX-x,w));A.width(C);y.setPosition(C/w*y.durationEstimate);
return false;}).bind(i,function(B){t=false;if(v.removeClass("searching").parent().hasClass("playing")){y.resume();}g(this).unbind(m);g(this).unbind(i);
return false;}).trigger({type:m,clientX:z.clientX});return false;}).parent().find(".ui").filter(".volume").bind(l,function(A){var v=g(this),B=v.find(".vol-position"),x=v.offset().left,w=v.width(),y=v.parent().data("mplayer"),z=null;
g(document).bind(m,function(E){var C=h?E.originalEvent.touches[0]:E;var D=Math.max(0,Math.min(C.clientX-x,w));z=Math.floor(D/w*100);B.width(D);soundManager._writeDebug("SET VOLUME: "+z);
y.setVolume(z);return false;}).bind(i,function(C){if($global_volume){$track_vol=z;}g(this).unbind(m);g(this).unbind(i);return false;}).trigger({type:m,clientX:A.clientX});
return false;});if(o&&c){c=false;u.data("mplayer").play();e=u.data("mplayer");}});_formatTime=function(o){var q=Math.floor(o/1000),n=Math.floor(q/60),p=q-n*60;
return n+":"+(p<10?"0"+p:p);};},play:function(){if(!d){return;}soundManager._writeDebug("PLAY EVENT");$this=g(this).data("mplayer");if(e&&e!=$this){e.stop();
e.setPosition(0);}if($this.playState==0||$this.paused){$this.play();e=$this;}},pause:function(){if(!d){return;}soundManager._writeDebug("PAUSE EVENT");
$this=g(this).data("mplayer");if($this.playState==1){$this.pause();}},stop:function(){if(!d){return;}soundManager._writeDebug("STOP EVENT");$this=g(this).data("mplayer");
$this.stop();$this.setPosition(0);},volume:function(h){if(!d){return;}soundManager._writeDebug("SET VOLUME: "+h);$this=g(this).data("mplayer");$this.setVolume(h);
}};g.fn.MPlayer=function(h){if(b[h]){return b[h].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof h==="object"||!h){return b.init.apply(this,arguments);
}else{g.error("Method "+method+" does not exist on jQuery.MPlayer");}}};})(jQuery);